<% isChild = (typeof isChild === 'undefined') ? false : isChild; %>

<% if (data.length) {
    var groupId = data[0].GroupId;
} %>

<% _.each(data, function(d) { %>
    <li class="list-group-item<% if (d.expanded || parseInt(state.module, 10) === d.id) { %> gh-list-group-item-open<% } %>" data-id="<%- d.id %>">
        <div class="gh-list-group-item-container">
            <% if (!isChild) { %>
                <button class="btn btn-link gh-toggle-list">
                    <div class="gh-list-icon">
                        <i class="fa<% if (d.expanded) { %> fa-caret-down<% } else { %> fa-caret-right<% } %>"></i>
                    </div>
            <% } else { %>
                <button class="btn btn-link gh-series-select<% if (parseInt(state.series, 10) === d.id && moduleMatch) { %> gh-series-active<% } %>">
            <% } %>
                    <div class="gh-list-description">
                        <p class="gh-list-description-text"><%- d.displayName %></p>
                    </div>
                    <% if (isChild) { %>
                        <% if (d.borrowedFrom) {%>
                            <%= _.partial('series-borrowed-popover', {'data': d}) %>
                        <% } %>
                        <div class="gh-list-action">
                            <span <% if(d.borrowedFrom) { %>class="gh-borrowed-icon-container"<% } %>>
                            <% if(d.borrowedFrom) { %>
                                <i class="fa fa-link" data-id="<%- d.id %>"></i>
                            <% } else { %>
                                <i class="fa fa-angle-right"></i>
                            <% } %>
                            </span>
                        </div>
                    <% } %>
                </button>
                <% if (!isChild) { %>
                    <ul class="nav nav-pills pull-right" role="tablist">
                        <li role="presentation" class="dropdown">
                            <button id="gh-batch-edit-settings" class="btn btn-default gh-btn-secondary gh-btn-reverse" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <span class="sr-only">Module settings</span>
                                <i class="fa fa-cog"></i>
                                <span class="caret"></span>
                            </button>
                            <ul class="dropdown-menu pull-right" role="menu" aria-labelledby="gh-batch-edit-settings">
                                <li role="presentation">
                                    <button type="button" class="btn btn-default gh-btn-secondary gh-new-series" role="menuitem" data-groupid="<%- groupId %>">New series</button>
                                </li>
                                <li role="presentation">
                                    <button type="button" class="btn btn-default gh-btn-secondary gh-borrow-series" role="menuitem">Borrow series</button>
                                </li>
                                <li role="presentation">
                                    <button type="button" class="btn btn-default gh-btn-secondary gh-rename-module" role="menuitem" data-id="<%- d.id %>" data-displayname="<%- d.displayName %>">Rename module</button>
                                </li>
                                <li role="presentation">
                                    <button type="button" class="btn btn-default gh-btn-secondary gh-delete-module" role="menuitem">Delete module</button>
                                </li>
                            </ul>
                        </li>
                    </ul>
                <% } %>
        </div>
        <% if (d.Series) { %>
            <ul class="list-group hide">
                <%= _.partial('admin-module-item', {
                    'data': d.Series,
                    'isChild': true,
                    'state': state,
                    'moduleMatch': parseInt(state.module, 10) === d.id
                }) %>
            </ul>
        <% } %>
    </li>
<% }); %>

<% if (isChild) { %>
    <div class="gh-list-group-series-actions">
        <button type="button" class="btn btn-default gh-btn-secondary gh-btn-reverse gh-new-series" data-groupid="<%- groupId %>"><i class="fa fa-plus-square"></i> New series</button>
        <button type="button" class="btn btn-default gh-btn-secondary gh-btn-reverse gh-borrow-series"><i class="fa fa-link"></i> Borrow</button>
    </div>
<% } %>
